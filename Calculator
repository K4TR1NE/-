import math
import sys

class AdvancedCalculator:
    def __init__(self):
        self.history = []
    
    def display_menu(self):
        """Отображает меню доступных операций"""
        print("\n" + "="*50)
        print("          РАСШИРЕННЫЙ КАЛЬКУЛЯТОР")
        print("="*50)
        print("1. Сложение (+)")
        print("2. Вычитание (-)")
        print("3. Умножение (*)")
        print("4. Деление (/)")
        print("5. Возведение в степень (^)")
        print("6. Квадратный корень (√)")
        print("7. Факториал (!)")
        print("8. Логарифм (log)")
        print("9. Тригонометрические функции")
        print("10. Проценты (%)")
        print("11. История вычислений")
        print("12. Очистить историю")
        print("0. Выход")
        print("="*50)
    
    def add_to_history(self, operation, result):
        """Добавляет операцию в историю"""
        self.history.append(f"{operation} = {result}")
    
    def show_history(self):
        """Показывает историю вычислений"""
        if not self.history:
            print("История пуста")
        else:
            print("\nИстория вычислений:")
            for i, entry in enumerate(self.history, 1):
                print(f"{i}. {entry}")
    
    def clear_history(self):
        """Очищает историю вычислений"""
        self.history.clear()
        print("История очищена")
    
    def get_number(self, prompt):
        """Получает число от пользователя с обработкой ошибок"""
        while True:
            try:
                return float(input(prompt))
            except ValueError:
                print("Ошибка! Пожалуйста, введите число.")
    
    def addition(self):
        """Сложение двух чисел"""
        print("\n--- СЛОЖЕНИЕ ---")
        a = self.get_number("Введите первое число: ")
        b = self.get_number("Введите второе число: ")
        result = a + b
        operation = f"{a} + {b}"
        print(f"Результат: {operation} = {result}")
        self.add_to_history(operation, result)
        return result
    
    def subtraction(self):
        """Вычитание двух чисел"""
        print("\n--- ВЫЧИТАНИЕ ---")
        a = self.get_number("Введите первое число: ")
        b = self.get_number("Введите второе число: ")
        result = a - b
        operation = f"{a} - {b}"
        print(f"Результат: {operation} = {result}")
        self.add_to_history(operation, result)
        return result
    
    def multiplication(self):
        """Умножение двух чисел"""
        print("\n--- УМНОЖЕНИЕ ---")
        a = self.get_number("Введите первое число: ")
        b = self.get_number("Введите второе число: ")
        result = a * b
        operation = f"{a} * {b}"
        print(f"Результат: {operation} = {result}")
        self.add_to_history(operation, result)
        return result
    
    def division(self):
        """Деление двух чисел"""
        print("\n--- ДЕЛЕНИЕ ---")
        a = self.get_number("Введите делимое: ")
        b = self.get_number("Введите делитель: ")
        
        if b == 0:
            print("Ошибка! Деление на ноль невозможно.")
            return None
        
        result = a / b
        operation = f"{a} / {b}"
        print(f"Результат: {operation} = {result}")
        self.add_to_history(operation, result)
        return result
    
    def power(self):
        """Возведение в степень"""
        print("\n--- ВОЗВЕДЕНИЕ В СТЕПЕНЬ ---")
        base = self.get_number("Введите основание: ")
        exponent = self.get_number("Введите степень: ")
        result = math.pow(base, exponent)
        operation = f"{base} ^ {exponent}"
        print(f"Результат: {operation} = {result}")
        self.add_to_history(operation, result)
        return result
    
    def square_root(self):
        """Квадратный корень"""
        print("\n--- КВАДРАТНЫЙ КОРЕНЬ ---")
        number = self.get_number("Введите число: ")
        
        if number < 0:
            print("Ошибка! Квадратный корень из отрицательного числа.")
            return None
            result = math.sqrt(number)
        operation = f"√{number}"
        print(f"Результат: {operation} = {result}")
        self.add_to_history(operation, result)
        return result
    
    def factorial(self):
        """Факториал числа"""
        print("\n--- ФАКТОРИАЛ ---")
        try:
            number = int(self.get_number("Введите целое неотрицательное число: "))
        except ValueError:
            print("Ошибка! Введите целое число.")
            return None
        
        if number < 0:
            print("Ошибка! Факториал определен только для неотрицательных чисел.")
            return None
        
        result = math.factorial(number)
        operation = f"{number}!"
        print(f"Результат: {operation} = {result}")
        self.add_to_history(operation, result)
        return result
    
    def logarithm(self):
        """Логарифм числа"""
        print("\n--- ЛОГАРИФМ ---")
        number = self.get_number("Введите число: ")
        base = self.get_number("Введите основание логарифма: ")
        
        if number <= 0 or base <= 0 or base == 1:
            print("Ошибка! Некорректные значения для логарифма.")
            return None
        
        result = math.log(number, base)
        operation = f"log_{base}({number})"
        print(f"Результат: {operation} = {result}")
        self.add_to_history(operation, result)
        return result
    
    def trigonometry(self):
        """Тригонометрические функции"""
        print("\n--- ТРИГОНОМЕТРИЧЕСКИЕ ФУНКЦИИ ---")
        print("1. Синус (sin)")
        print("2. Косинус (cos)")
        print("3. Тангенс (tan)")
        print("4. Арксинус (arcsin)")
        print("5. Арккосинус (arccos)")
        print("6. Арктангенс (arctan)")
        
        choice = input("Выберите функцию (1-6): ")
        angle = self.get_number("Введите угол в градусах: ")
        angle_rad = math.radians(angle)
        
        if choice == '1':
            result = math.sin(angle_rad)
            operation = f"sin({angle}°)"
        elif choice == '2':
            result = math.cos(angle_rad)
            operation = f"cos({angle}°)"
        elif choice == '3':
            result = math.tan(angle_rad)
            operation = f"tan({angle}°)"
        elif choice == '4':
            if -1 <= angle <= 1:
                result = math.degrees(math.asin(angle))
                operation = f"arcsin({angle})"
            else:
                print("Ошибка! Арксинус определен только для значений от -1 до 1.")
                return None
        elif choice == '5':
            if -1 <= angle <= 1:
                result = math.degrees(math.acos(angle))
                operation = f"arccos({angle})"
            else:
                print("Ошибка! Арккосинус определен только для значений от -1 до 1.")
                return None
        elif choice == '6':
            result = math.degrees(math.atan(angle))
            operation = f"arctan({angle})"
        else:
            print("Неверный выбор!")
            return None
        
        print(f"Результат: {operation} = {result}")
        self.add_to_history(operation, result)
        return result
    
    def percentage(self):
        """Вычисление процентов"""
        print("\n--- ПРОЦЕНТЫ ---")
        print("1. Найти процент от числа")
        print("2. Найти, сколько процентов составляет одно число от другого")
        print("3. Увеличить число на процент")
        print("4. Уменьшить число на процент")
        
        choice = input("Выберите операцию (1-4): ")
        
        if choice == '1':
            number = self.get_number("Введите число: ")
            percent = self.get_number("Введите процент: ")
            result = (number * percent) / 100
            operation = f"{percent}% от {number}"
            print(f"Результат: {operation} = {result}")
        
        elif choice == '2':
            part = self.get_number("Введите часть: ")
            whole = self.get_number("Введите целое: ")
            if whole == 0:
                print("Ошибка! Деление на ноль.")
                return None
                result = (part / whole) * 100
            operation = f"{part} от {whole}"
            print(f"Результат: {operation} = {result}%")
        
        elif choice == '3':
            number = self.get_number("Введите число: ")
            percent = self.get_number("Введите процент: ")
            result = number * (1 + percent / 100)
            operation = f"{number} + {percent}%"
            print(f"Результат: {operation} = {result}")
        
        elif choice == '4':
            number = self.get_number("Введите число: ")
            percent = self.get_number("Введите процент: ")
            result = number * (1 - percent / 100)
            operation = f"{number} - {percent}%"
            print(f"Результат: {operation} = {result}")
        
        else:
            print("Неверный выбор!")
            return None
        
        self.add_to_history(operation, result)
        return result
    
    def run(self):
        """Основной цикл программы"""
        print("Добро пожаловать в расширенный калькулятор!")
        
        while True:
            self.display_menu()
            choice = input("Выберите операцию (0-12): ")
            
            if choice == '0':
                print("До свидания!")
                break
            
            elif choice == '1':
                self.addition()
            elif choice == '2':
                self.subtraction()
            elif choice == '3':
                self.multiplication()
            elif choice == '4':
                self.division()
            elif choice == '5':
                self.power()
            elif choice == '6':
                self.square_root()
            elif choice == '7':
                self.factorial()
            elif choice == '8':
                self.logarithm()
            elif choice == '9':
                self.trigonometry()
            elif choice == '10':
                self.percentage()
            elif choice == '11':
                self.show_history()
            elif choice == '12':
                self.clear_history()
            else:
                print("Неверный выбор! Пожалуйста, выберите от 0 до 12.")
            
            input("\nНажмите Enter для продолжения...")

if __name__ == "__main__":
    calculator = AdvancedCalculator()
    calculator.run()
